---
title: "Index of Suspicion"
Author: Yoonsu Cho
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


---
title: "MR.IOS examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, message=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Empirical examples using mr.ios packages
Here we tested the associations of the following phenotypes;
   1. BMI - CHD
   2. SBP - CHD
   3. EDU - BMI
   4. Sleep - Schizophrenia 
   5. Urate - CHD
   6. Urate - eGFR
   7. CRP - CHD
   8. CRP - SCZ
   
   
   
```{r}
#install.packages("devtools")
#devtools::install_github("universe77/mr.ios")
#devtools::install_github("universe77/RadialMR")

library(devtools)
library(mr.ios)
library(RadialMR)
library(TwoSampleMR)
library(dplyr)
library(tidyverse)
```


## SBP-CHD

```{r}
# choose exposure - SBP
id_exp <- "ukb-b-20175"
exp_dat <- extract_instruments(id_exp)

# choose outcome - CHD
id_out <- "ieu-a-7"
out_dat <- extract_outcome_data(exp_dat$SNP, id_out)

# choose background dataset list
id_bg <- background_ids(id_exp=id_exp, id_out=id_out, type = "broad")
id_bg2 <- background_ids(id_exp=id_exp, id_out=id_out, type = "default")

# make background dataset
bg_dat <- make_background(exp = exp_dat, id_bg = id_bg)
bg_dat2 <- make_background(exp = exp_dat, id_bg = id_bg2)
```


```{r}
# make harmonised dataset
dat <- harmonise_data(exp_dat, out_dat)
```

For MR in each group of cluster for instruments:
```{r}
#----------------------------------------------------------------------------------------------
# MR Clustering
#----------------------------------------------------------------------------------------------

kmean <- mr_cluster(bg = bg_dat, dat = dat, method = c("kmean"))
hclust <- mr_cluster(bg = bg_dat, dat = dat, method = c("hclust"))
#pv <- mr_cluster(bg = bg_dat, dat = dat, method = c("pv"))
pam <- mr_cluster(bg = bg_dat, dat = dat, method = c("pam"))

```

Test if esimates from each cluster give substantially different results using Search Results Durbin–Wu–Hausman test




Calculate Q statistics of the model with clustering 
```{r}

Q_kmean <- mr_cluster_heterogeneity(dat = dat, cluster = kmean, weights = 3)
Q_hclust <- mr_cluster_heterogeneity(dat = dat, cluster = hclust, weights = 3)
Q_pam <- mr_cluster_heterogeneity(dat = dat, cluster = pam, weights = 3)


```




- Identify the background traits related to each cluster
